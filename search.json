[
  {
    "objectID": "slides/slide3.html#probability-distributions",
    "href": "slides/slide3.html#probability-distributions",
    "title": "Structure and diagnostics",
    "section": "Probability Distributions",
    "text": "Probability Distributions"
  },
  {
    "objectID": "slides/slide3.html#generalised-linear-models",
    "href": "slides/slide3.html#generalised-linear-models",
    "title": "Structure and diagnostics",
    "section": "Generalised linear models",
    "text": "Generalised linear models\nGeneralised linear models (GLMs) has two components:\n\n\n\n\n\n\nA random component\n\n\nY_i has a distribution from the exponential family with mean \\mu_i = E(Y_i).\n\n\n\n\n\n\n\n\n\nA systematic component\n\n\nA linear predictor: g(\\mu_i) = \\eta_i = o_i + \\beta_0 + \\beta_1 x_{i1} + \\ldots + \\beta_k x_{ik}\nwhere\n\ng(\\cdot) is a (smooth and invertible) link function, and\no_i is the offset value for the i-th observation (if any)."
  },
  {
    "objectID": "slides/slide3.html#exponential-family",
    "href": "slides/slide3.html#exponential-family",
    "title": "Structure and diagnostics",
    "section": "Exponential family",
    "text": "Exponential family\n\n\n\n\nA distribution is part of the exponential family if the probability density/mass function can be written in the form:\nf(y;\\theta, \\phi) = a(y, \\theta)\\text{exp}\\left(\\frac{y\\cdot\\theta - \\kappa(\\theta)}{\\psi}\\right)\n\n\\theta is the canonical parameter\n\\kappa(\\theta) is a known function called the cumulant function\n\\phi &gt; 0 is the dispersion parameter\na(y, \\theta) is a normalising constant."
  },
  {
    "objectID": "slides/slide3.html#which-glm-to-use",
    "href": "slides/slide3.html#which-glm-to-use",
    "title": "Structure and diagnostics",
    "section": "Which GLM to use?",
    "text": "Which GLM to use?\n\n\nFor the random component:\n\nWhat distribution is appropriate?\nWhat is the response type? E.g. positive integer, continuous over infinite support, etc.\n\nFor the systematic component:\n\nHow are the explanatory variables related to the mean of the response variable?\nDo the explanatory variables need to be transformed or removed?\n\nFor the practical component:\n\nAre the interpretation from the fitted model understandable?\nCan you fit the model in practice?"
  },
  {
    "objectID": "slides/slide3.html#default-link-function",
    "href": "slides/slide3.html#default-link-function",
    "title": "Structure and diagnostics",
    "section": "Default Link Function",
    "text": "Default Link Function\n\n\n\n\n\n\n\n\n\n\nFamily\nDefault Link\ng(\\mu)\ng^{-1}(\\eta)\nRange of Y_i\n\n\n\n\nNormal/Gaussian\nIdentity\n\\mu\n\\eta\n(-\\infty, \\infty)\n\n\nBinomial\nLogit\n\\log_e(\\frac{\\mu}{1 - \\mu})\n\\frac{\\text{exp}(\\eta)}{1 + \\text{exp}(\\eta)}\n[0, 1]\n\n\nPoisson\nLog\n\\log_e(\\mu)\n\\text{exp}(\\eta)\n[0, \\infty)\n\n\nNegative Binomial\nLog\n\\log_e(\\mu)\n\\text{exp}(\\eta)\n[0, \\infty)\n\n\n\n\n\\mu is the expected value on the response scale\n\\eta is the expected value on the link scale"
  },
  {
    "objectID": "slides/slide3.html#fitting-glms-in-r",
    "href": "slides/slide3.html#fitting-glms-in-r",
    "title": "Structure and diagnostics",
    "section": "Fitting GLMs in R",
    "text": "Fitting GLMs in R\nglm(y ~ x, family = dist(link = \"function\"), data = data)\n\n\n\n\n\n\n\n\n\n\nFamily\nFunction\nDefault Link\nOther Links\n\n\n\n\nNormal/Gaussian\ngaussian\nidentity\nlog, inverse\n\n\nGamma\nGamma\ninverse\nidentity, log\n\n\nBinomial\nbinomial\nlogit\nprobit, cauchit, log, cloglog\n\n\nPoisson\npoisson\nlog\nlog, identity, sqrt\n\n\nNegative Binomial*\nMASS::glm.nb\nlog\nsqrt, identity\n\n\n\n\nThe default links in R are the canonical link (except for the Negative Binomial)\n*Negative Binomial is specified with glm.nb from the MASS package and does not require family to be specified."
  },
  {
    "objectID": "slides/slide3.html#quantile-residual-plot",
    "href": "slides/slide3.html#quantile-residual-plot",
    "title": "Structure and diagnostics",
    "section": "Quantile residual plot",
    "text": "Quantile residual plot"
  },
  {
    "objectID": "slides/slide3.html#checking-the-random-component",
    "href": "slides/slide3.html#checking-the-random-component",
    "title": "Structure and diagnostics",
    "section": "Checking the random component",
    "text": "Checking the random component"
  },
  {
    "objectID": "slides/slide3.html#summary",
    "href": "slides/slide3.html#summary",
    "title": "Structure and diagnostics",
    "section": "Summary",
    "text": "Summary\n\nA generalised linear model are regression models that consist of two components:\n\na random component (requiring decision on a distribution from the exponential family): Y_i \\sim \\text{Exponential family}(\\mu_i, \\psi/w_i)\na systematic component (requiring decision on the link function): g(\\mu_i) = \\eta_i = o_i + \\beta_0 + \\beta_1 x_{i1} + \\ldots + \\beta_k x_{ik}.\n\n\n\n\n\n\n\nanu-bdsi.github.io/workshop-GLM/"
  },
  {
    "objectID": "slides/slide1.html#case-study-longevity-of-fruitflies",
    "href": "slides/slide1.html#case-study-longevity-of-fruitflies",
    "title": "Modelling for binary or proportion responses",
    "section": "Case study: Longevity of fruitflies",
    "text": "Case study: Longevity of fruitflies\nAim: Study longevity of fruitflies depending on sexual activity and thorax length\n\n\n\n\nCode\nlibrary(tidyverse)\ngfly &lt;- faraway::fruitfly |&gt; \n  mutate(activity = factor(activity, levels = c(\"isolated\", \"low\", \"high\", \"one\", \"many\"))) |&gt; \n  ggplot(aes(x = thorax, y = longevity, color = activity)) + \n  geom_point(data = ~select(., -activity), color = \"lightgrey\") +\n  geom_point(size = 4) + \n  facet_wrap(~activity, labeller = label_both) +\n  guides(color = \"none\") + \n  colorspace::scale_color_discrete_qualitative()\n\ngfly\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n125 fruitflies were divided randomly into 5 groups of 25 each.\nThe response was the longevity of the fruitfly in days.\nOne group was kept solitary (“isolated”).\n\nAnother was kept individually with a virgin female each day (“low”).\nAnother group was given 8 virgin females per day (“high”).\nAs an additional control the fourth and fifth groups were kept with one (“one”) or eight (“many”) pregnant females per day.\nPregnant fruitflies will not mate.\nThe thorax length of each male was measured as this was known to affect longevity.\nOne observation in the many group has been lost."
  },
  {
    "objectID": "slides/slide1.html#linear-model-1",
    "href": "slides/slide1.html#linear-model-1",
    "title": "Modelling for binary or proportion responses",
    "section": "Linear model 1",
    "text": "Linear model 1\nlm(longevity ~ thorax + activity + thorax:activity)\n\\texttt{longevity}_i = \\beta_0 + \\beta_1\\texttt{thorax}_i + \\beta_{2,T(i)} + \\beta_{3,T(i)}\\texttt{thorax}_i + \\epsilon_i\n\n\n\nwhere\n\n\\beta_0 is the overall intercept,\n\\beta_1 is the effect of thorax length on longevity,\n\\beta_{2,T(i)} is the effect of activity on longevity,\nT(i) maps to the activity type of the i-th observation,\n\\beta_{3,T(i)} is the interaction effect between thorax length and activity type, and\n\\epsilon_i is the error term.\n\n\nNote that:\n\nWe assume \\epsilon_i  \\stackrel{iid}{\\sim} N(0, \\sigma^2).\nWe use the constraints: \\beta_{2,1} = 0 and \\beta_{3,1} = 0.\n\\beta_0 + \\beta_{2,k} is the intercept for the k-th activity type.\n\\beta_1 + \\beta_{3,k} is the slope for the k-th activity type.\n\n\n\n\n\n\n\n\nCode\ngfly + geom_smooth(method = \"lm\", se = FALSE, color = \"black\", linewidth = 2)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\nflyfit1 &lt;- lm(longevity ~ thorax + activity + thorax:activity, data = faraway::fruitfly) |&gt; \n  broom::augment() |&gt; \n  mutate(activity = factor(activity, levels = c(\"isolated\", \"low\", \"high\", \"one\", \"many\"))) \ngres &lt;- flyfit1 |&gt; \n  ggplot(aes(.fitted, .resid, color = activity)) + \n  geom_point(data = ~select(., -activity), color = \"lightgrey\") + \n  geom_point(size = 4) +\n  #facet_wrap(~activity, labeller = label_both) +\n  guides(color = \"none\") +\n  geom_hline(yintercept = 0, color = \"black\", linetype = 2) +\n  colorspace::scale_color_discrete_qualitative() +\n  labs(x = \"Fitted values\", y = \"Residual\", title = \"Residual vs fitted values plot\")\n\ngres"
  },
  {
    "objectID": "slides/slide1.html#linear-model-2",
    "href": "slides/slide1.html#linear-model-2",
    "title": "Modelling for binary or proportion responses",
    "section": "Linear model 2",
    "text": "Linear model 2\nlm(log10(longevity) ~ thorax + activity + thorax:activity)\n\\log_{10}(\\texttt{longevity}_i) = \\beta_0 + \\beta_1\\texttt{thorax}_i + \\beta_{2,T(i)} + \\beta_{3,T(i)}\\texttt{thorax}_i + \\epsilon_i\n\n\n\n\nCode\ngfly + geom_smooth(method = \"lm\", se = FALSE, color = \"black\", linewidth = 2) +\n  scale_y_log10()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\nflyfit2 &lt;- lm(log10(longevity) ~ thorax + activity + thorax:activity, data = faraway::fruitfly) |&gt; \n  broom::augment() |&gt; \n  mutate(.fitted = 10^.fitted) |&gt; \n  mutate(activity = factor(activity, levels = c(\"isolated\", \"low\", \"high\", \"one\", \"many\"))) \n\ngres %+% flyfit2"
  },
  {
    "objectID": "slides/slide1.html#linear-model-3",
    "href": "slides/slide1.html#linear-model-3",
    "title": "Modelling for binary or proportion responses",
    "section": "Linear model 3",
    "text": "Linear model 3\nlm(log10(longevity) ~ thorax + activity)\n\\log_{10}(\\texttt{longevity}_i) = \\beta_0 + \\beta_1\\texttt{thorax}_i + \\beta_{2,T(i)} + \\epsilon_i\n\n\nfit1 &lt;- lm(log10(longevity) ~ thorax + activity, data = faraway::fruitfly)\nfit2 &lt;- lm(log10(longevity) ~ thorax + activity + thorax:activity, data = faraway::fruitfly)\nanova(fit1, fit2)\n\nAnalysis of Variance Table\n\nModel 1: log10(longevity) ~ thorax + activity\nModel 2: log10(longevity) ~ thorax + activity + thorax:activity\n  Res.Df     RSS Df Sum of Sq      F Pr(&gt;F)\n1    118 0.83011                           \n2    114 0.78511  4  0.044997 1.6334 0.1706\n\n\n\n\n\n\n\nCode\nfit &lt;- lm(log10(longevity) ~ -1 + thorax + activity, data = faraway::fruitfly)\nest &lt;- tibble(slope = coef(fit)[1], \n              intercept = coef(fit)[-1],\n              activity = str_remove(names(coef(fit)[-1]), \"^activity\")) |&gt; \nmutate(activity = factor(activity, levels = c(\"isolated\", \"low\", \"high\", \"one\", \"many\"))) \ngfly + geom_abline(aes(slope = slope, intercept = intercept), color = \"black\", linewidth = 2, data = est) + scale_y_log10()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\ngres %+% (broom::augment(fit) |&gt; \n  mutate(activity = factor(activity, levels = c(\"isolated\", \"low\", \"high\", \"one\", \"many\"))))"
  },
  {
    "objectID": "slides/slide1.html#multiple-linear-regression",
    "href": "slides/slide1.html#multiple-linear-regression",
    "title": "Modelling for binary or proportion responses",
    "section": "Multiple linear regression",
    "text": "Multiple linear regression\nFor i = 1, ..., n, the linear regression model is given by\ny_i = \\beta_0 + \\beta_1x_{i1} + \\beta_2x_{i2} + \\cdots + \\beta_kx_{ik} + \\epsilon_i=  \\sum_{j=0}^{k}\\beta_jx_{ij} + \\epsilon_i\nwhere\n\ny_i is the response variable,\nx_{ij} is the j-th predictor variable and x_{0j} = 1 for all j,\n\\beta_j is the coefficient for the j-th predictor variable,\n\\epsilon_i is the error term, and\nwe assume that \\epsilon_i \\stackrel{iid}{\\sim} N(0, \\sigma^2)."
  },
  {
    "objectID": "slides/slide1.html#case-study-breast-cancer-diagnosis",
    "href": "slides/slide1.html#case-study-breast-cancer-diagnosis",
    "title": "Modelling for binary or proportion responses",
    "section": "Case study: Breast cancer diagnosis",
    "text": "Case study: Breast cancer diagnosis\nAim: diagnose breast cancer from features of a digitized image of breast mass sample\n\n\n\n\nCode\nlibrary(tidyverse)\ncancer &lt;- read_csv(\"https://anu-bdsi.github.io/workshop-GLM/data/cancer.csv\") \n\ncancer |&gt; \n  select(diagnosis, radius_mean, concave_points_mean) |&gt; \n  GGally::ggpairs(mapping = aes(color = diagnosis)) \n\n\n\n\n\n\n\n\n\n\n\nThe Wisconsin breast cancer data set contains data of features of digitized image of a breast mass sample.\n\n\n\n\n\nThe image features include the average radius (radius_mean) and the average concave portion of the contour (concave_points_mean).\nThe breast mass sample was diagnosed as malignant (M) or benign (B).\n\n\n\n\n\nImage from Street, Wolberg, and Mangasarian (1993) Nuclear feature extraction for breast tumor diagnosis. Biomedical Image Processing and Biomedical Visualization vol 1905 pp/ 861–870. doi:10.1117/12.148698."
  },
  {
    "objectID": "slides/slide1.html#binary-response",
    "href": "slides/slide1.html#binary-response",
    "title": "Modelling for binary or proportion responses",
    "section": "Binary response",
    "text": "Binary response\n\n\n\n\nCode\ncancer |&gt; \n  count(diagnosis) |&gt; \n  ggplot(aes(diagnosis, n)) +\n  geom_col(aes(fill = diagnosis)) +\n  scale_y_continuous(expand = expansion(add = c(0, 0.1))) +\n  labs(y = \"Count\") +\n  guides(fill = \"none\")\n\n\n\n\n\n\n\n\n\n\n\nThe outcome of interest is a binary response (M or B).\nWe can convert it to a numeric value such that M = 1 and B = 0.\n\n\n\nShould we model this assuming that using a linear model?\n\n\n\n\nCode\ncancer |&gt; \n  ggplot(aes(radius_mean, diagnosis_malignant)) +\n  geom_point(alpha = 0.25, size = 2, aes(color = diagnosis)) +\n  geom_smooth(method = lm,\n              formula = y ~ x,\n              se = FALSE,\n              color = \"black\",\n              linewidth = 1.2) +\n  scale_y_continuous(breaks = c(0, 1)) +\n  labs(y = \"diagnosis\") +\n  guides(color = \"none\")"
  },
  {
    "objectID": "slides/slide1.html#propensity-score",
    "href": "slides/slide1.html#propensity-score",
    "title": "Modelling for binary or proportion responses",
    "section": "Propensity score",
    "text": "Propensity score\n\n\nSuppose we consider Y_i as a binary category: Y_i = \\begin{cases}\n     1 & \\text{ if $i$-th observation is in class 1}\\\\\n     0 & \\text{ if $i$-th observation is in class 2}\\\\\n\\end{cases}\nInstead of modelling the outcome directly, we consider the conditional probability, say P(Y_i = 1|\\boldsymbol{x}_i) where \\boldsymbol{x}_i = (x_{i1}, x_{i2}, \\ldots, x_{ik}), also known as the propensity score of class 1.\nThe propensity score of class 2 is P(Y_i=0|\\boldsymbol{x}_i) = 1 - P(Y_i=1|\\boldsymbol{x}_i)."
  },
  {
    "objectID": "slides/slide1.html#odds-of-an-event",
    "href": "slides/slide1.html#odds-of-an-event",
    "title": "Modelling for binary or proportion responses",
    "section": "Odds of an event",
    "text": "Odds of an event\n\nThe odds of an event is defined as \\text{odds} = \\color{#BE830E}{\\frac{p}{1-p}} = \\frac{\\text{probability that the event will occur}}{\\text{probability that the event will not occur}}, where p is the probability of an event occuring.\n\n\n\nThe ratio of the propensity scores of the two classes is the odds of being in class 1:\n\n\\text{odds} = \\frac{P(Y_i=1|\\boldsymbol{x}_i)}{1-P(Y_i=1|\\boldsymbol{x}_i)}."
  },
  {
    "objectID": "slides/slide1.html#logistic-function",
    "href": "slides/slide1.html#logistic-function",
    "title": "Modelling for binary or proportion responses",
    "section": "Logistic function",
    "text": "Logistic function\n\nThe logistic function:\n\n\n\ng(z) = \\frac{e^z}{1+e^z} = \\frac{1}{1+e^{-z}}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nNotice that 0 &lt; g(z) &lt; 1 for all finite values of z."
  },
  {
    "objectID": "slides/slide1.html#logit-function",
    "href": "slides/slide1.html#logit-function",
    "title": "Modelling for binary or proportion responses",
    "section": "Logit function",
    "text": "Logit function\n\nThe logit function:\n\n\n\nf(p) = \\log_e \\left(\\frac{p}{1- p}\\right)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nHere -\\infty &lt; f(p) &lt; \\infty for all p \\in (0, 1).\n\n\n\nNote that logit and logistic functions are inverse functions of one another, i.e. f(g(z)) = z and g(f(p)) = p."
  },
  {
    "objectID": "slides/slide1.html#binomial-distribution",
    "href": "slides/slide1.html#binomial-distribution",
    "title": "Modelling for binary or proportion responses",
    "section": "Binomial distribution",
    "text": "Binomial distribution\n\n\n\nSuppose Y is binomially distributed B(n, p).\nThis means that there were n trials, each with a probability p of success, and Y is the number of successes out of n.\nThe expected value of Y is E(Y) = np.\nIf n=1, Y can only take the values 0 or 1 and the distribution is referred to as Benoulli distribution."
  },
  {
    "objectID": "slides/slide1.html#logistic-regression-for-a-binary-response",
    "href": "slides/slide1.html#logistic-regression-for-a-binary-response",
    "title": "Modelling for binary or proportion responses",
    "section": "Logistic regression for a binary response",
    "text": "Logistic regression for a binary response\n\nLogistic regression models the log odds as a linear combination of predictors: \\text{logit}(p_i) = \\log_e \\left(\\frac{p_i}{1-p_i}\\right) = \\sum_{j=0}^p\\beta_jx_{ij}, \\quad p_i = \\frac{e^{\\sum_{j=0}^p\\beta_jx_{ij}}}{1+e^{\\sum_{j=0}^p\\beta_jx_{ij}}}\nWe assume that Y_i \\sim B(1, p_i) where p_i = P(Y_i=1|\\boldsymbol{x}_i).\nNote that E(Y_i|\\boldsymbol{x}_i) = p_i."
  },
  {
    "objectID": "slides/slide1.html#logistic-regression-for-a-binary-response-1",
    "href": "slides/slide1.html#logistic-regression-for-a-binary-response-1",
    "title": "Modelling for binary or proportion responses",
    "section": " Logistic regression for a binary response",
    "text": "Logistic regression for a binary response\n\nWhen response is a binary value (0 or 1):\n\n\n\nCode for loading data\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\n\nFit the logistic model in R as\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page."
  },
  {
    "objectID": "slides/slide1.html#logistic-regression-for-a-factor-response",
    "href": "slides/slide1.html#logistic-regression-for-a-factor-response",
    "title": "Modelling for binary or proportion responses",
    "section": " Logistic regression for a factor response",
    "text": "Logistic regression for a factor response\n\nWhen response is a factor, the first level is considered failure, every other level is considered success.\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\n\n Watch out for the order of the levels!\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page."
  },
  {
    "objectID": "slides/slide1.html#interpretation-of-logistic-regression",
    "href": "slides/slide1.html#interpretation-of-logistic-regression",
    "title": "Modelling for binary or proportion responses",
    "section": "Interpretation of logistic regression",
    "text": "Interpretation of logistic regression\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\nIncreasing radius_mean by one unit changes the log odds by \\hat{\\beta}_1, 0.639, or equivalently it multiplies the odds by e^{\\hat\\beta_1}, 1.894, provided concave_points_mean is held fixed."
  },
  {
    "objectID": "slides/slide1.html#predicting-from-logistic-regression",
    "href": "slides/slide1.html#predicting-from-logistic-regression",
    "title": "Modelling for binary or proportion responses",
    "section": " Predicting from logistic regression",
    "text": "Predicting from logistic regression\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\n\nAlternative method\n\n\nYou can also get the prediction with:\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\nBy hand\n\\hat{\\eta} = -13.699 + 0.639\\times 15 + 84.223\\times 0.05 \\approx 0.0961\n\\dfrac{\\exp(0.0961)}{1 + \\exp(0.0961)} = 0.524"
  },
  {
    "objectID": "slides/slide1.html#logistic-regression-is-a-linear-classifier",
    "href": "slides/slide1.html#logistic-regression-is-a-linear-classifier",
    "title": "Modelling for binary or proportion responses",
    "section": "Logistic regression is a linear classifier",
    "text": "Logistic regression is a linear classifier\n\nWe choose the threshold q such that P(Y_i=1|\\boldsymbol{x}_i) \\ge q is considered to be in class 1.\nThe separation in class is a point for one variable, line for two variables and a hyperplane for more than two variables."
  },
  {
    "objectID": "slides/slide1.html#case-study-germination-of-seeds",
    "href": "slides/slide1.html#case-study-germination-of-seeds",
    "title": "Modelling for binary or proportion responses",
    "section": "Case study: Germination of seeds",
    "text": "Case study: Germination of seeds\n\nResponse does not have to be a binary response to fit a logistic regression.\nObservations may be count (out of fixed trials).\nBelow is an experiment where the number of seeds germination was recorded for two types of seeds and two types of root extracts.\n\n\n\n\n\nCode\ndata(germ, package = \"GLMsData\")\ngerm &lt;- germ |&gt; \n  mutate(Proportion_Germ = Germ / Total)\n\n\n\n\n\n\n\nGerm\nTotal\nExtract\nSeeds\nProportion_Germ\n\n\n\n\n10\n39\nBean\nOA75\n0.2564103\n\n\n23\n62\nBean\nOA75\n0.3709677\n\n\n23\n81\nBean\nOA75\n0.2839506\n\n\n26\n51\nBean\nOA75\n0.5098039\n\n\n17\n39\nBean\nOA75\n0.4358974\n\n\n5\n6\nCucumber\nOA75\n0.8333333\n\n\n53\n74\nCucumber\nOA75\n0.7162162\n\n\n55\n72\nCucumber\nOA75\n0.7638889\n\n\n32\n51\nCucumber\nOA75\n0.6274510\n\n\n46\n79\nCucumber\nOA75\n0.5822785\n\n\n10\n13\nCucumber\nOA75\n0.7692308\n\n\n8\n16\nBean\nOA73\n0.5000000\n\n\n10\n30\nBean\nOA73\n0.3333333\n\n\n8\n28\nBean\nOA73\n0.2857143\n\n\n23\n45\nBean\nOA73\n0.5111111\n\n\n0\n4\nBean\nOA73\n0.0000000\n\n\n3\n12\nCucumber\nOA73\n0.2500000\n\n\n22\n41\nCucumber\nOA73\n0.5365854\n\n\n15\n30\nCucumber\nOA73\n0.5000000\n\n\n32\n51\nCucumber\nOA73\n0.6274510\n\n\n3\n7\nCucumber\nOA73\n0.4285714\n\n\n\n\n\n\n\n\nCode\ngerm |&gt;  \n  mutate(NotGerm = Total - Germ) |&gt; \n  pivot_longer(cols = c(Germ, NotGerm), names_to = \"Germ\", values_to = \"Freq\") |&gt;\n  ggplot(aes(Germ, Freq)) +\n  geom_col() +\n  facet_grid(Extract ~ Seeds, labeller = label_both) +\n  labs(y = \"Count\")"
  },
  {
    "objectID": "slides/slide1.html#logistic-regression-with-count-responses",
    "href": "slides/slide1.html#logistic-regression-with-count-responses",
    "title": "Modelling for binary or proportion responses",
    "section": " Logistic regression with count responses",
    "text": "Logistic regression with count responses\n\nThe response need to be specified as a two column matrix with the counts of each class.\n\n\n\nCode to load data\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page."
  },
  {
    "objectID": "slides/slide1.html#logistic-regression-with-proportion-responses",
    "href": "slides/slide1.html#logistic-regression-with-proportion-responses",
    "title": "Modelling for binary or proportion responses",
    "section": " Logistic regression with proportion responses",
    "text": "Logistic regression with proportion responses\n\nYou need the total cases for each proportion to fit the model.\nThe exception is if the total cases are the same for all observations.\n\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page."
  },
  {
    "objectID": "slides/slide1.html#summary",
    "href": "slides/slide1.html#summary",
    "title": "Modelling for binary or proportion responses",
    "section": "Summary",
    "text": "Summary\n\nOdds ratio is the ratio of the odds of the event happening in one group to the odds of the event happening in another group.\nLogistic regression can be used to model binary or proportion (out of total cases) responses by modelling the log odds as a linear combination of predictors.\nLogistic regression is a linear classifier so it doesn’t work well where the separation between classes are non-linear.\nUse glm(y ~ x, family = binomial(link = \"logit\")) to fit a logistic regression model.\n\n\n\n\n\nanu-bdsi.github.io/workshop-GLM/"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Generalised Linear Models",
    "section": "",
    "text": "This is a training workshop for BIOL8001 students but extended to also staff and students affiliated with the Australian National University (ANU) offered by the ANU Biological Data Science Institute (BDSI).\nThe workshop aims to teach generalised linear models for modeling data with non-normal distributions. Participants are expected to have a basic understanding of R and linear models prior to the start of the workshop.\nThis website is brought to you by the ANU Biological Data Science Institute."
  },
  {
    "objectID": "index.html#welcome",
    "href": "index.html#welcome",
    "title": "Generalised Linear Models",
    "section": "",
    "text": "This is a training workshop for BIOL8001 students but extended to also staff and students affiliated with the Australian National University (ANU) offered by the ANU Biological Data Science Institute (BDSI).\nThe workshop aims to teach generalised linear models for modeling data with non-normal distributions. Participants are expected to have a basic understanding of R and linear models prior to the start of the workshop."
  },
  {
    "objectID": "index.html#learning-objectives",
    "href": "index.html#learning-objectives",
    "title": "Generalised Linear Models",
    "section": "🎯 Learning objectives",
    "text": "🎯 Learning objectives\nUpon completion of this workshop, participants should be able to:\n\nUnderstand and apply generalized linear models (GLMs) for modeling data with non-normal distributions\nApply GLMs effectively to model binary outcomes (logistic regression) and count data (Poisson or negative binomial regression).\nFit, interpret, and assess the adequacy of GLMs"
  },
  {
    "objectID": "index.html#preparation",
    "href": "index.html#preparation",
    "title": "Generalised Linear Models",
    "section": "🔧 Preparation",
    "text": "🔧 Preparation\nPlease ensure that you download and install\n\nthe latest version of R,\nthe latest version of RStudio Desktop or Positron, and\nthe following packages by opening RStudio Desktop or Positron, then copy and paste the command below in the Console section, pushing Enter after pasting.\n\ninstall.packages(c(\"tidyverse\", \"broom\", \"faraway\", \"GLMsData\", \"GGally\"))\n\nFor Window users, you may need to install Rtools to install R packages."
  },
  {
    "objectID": "index.html#slides",
    "href": "index.html#slides",
    "title": "Generalised Linear Models",
    "section": "📚 Slides",
    "text": "📚 Slides\n\n  \n  \n  \n    \n      \n        image/svg+xml\n        \n      \n    \n  \n  \n    \n      \n      \n      \n        \n        \n          \n        \n      \n      \n        \n        \n          \n          \n        \n        \n      \n      \n        \n        \n      \n      \n        \n        \n      \n      \n        \n        \n      \n      \n        \n        \n          \n          \n        \n      \n      \n        \n        \n      \n    \n  \n\nClick on the heading to open the slides in a new tab, or click on details to see the slides on this page.\n\nModelling for binary or proportion responses\n\n\n\n Self test with Exercise 1"
  },
  {
    "objectID": "index.html#resources",
    "href": "index.html#resources",
    "title": "Generalised Linear Models",
    "section": "📑 Resources",
    "text": "📑 Resources\n\nFaraway (2009) Linear Models with R (for review of linear models)\nChapters 2, 3, and 5 from Faraway (2016) Extending the Linear Model with R. 2nd Edition.\nDunn and Smyth (2018) Generalized Linear Models With Examples in R"
  },
  {
    "objectID": "index.html#self-paced-exercises",
    "href": "index.html#self-paced-exercises",
    "title": "Generalised Linear Models",
    "section": "🏋️‍♀️ Self-paced exercises",
    "text": "🏋️‍♀️ Self-paced exercises\nThe following self-paced exercises are designed to check your understanding of the material.\n\n\n\n\n\n\nReflect on learning objectives\n\n\n\nYou should be able to:\n\n\n Understand and apply generalized linear models (GLMs) for modeling data with non-normal distributions\n\n\n Apply GLMs effectively to model binary outcomes (logistic regression) and count data (Poisson or negative binomial regression).\n\n\n Fit, interpret, and assess the adequacy of GLMs\n\n\n\n\n\nExercise 1\n\n\nQuestion: What might affect the chance of getting heart disease?\n\n\n\n\n\n\nAbout the data\n\n\n\n\nWe have the data from Western Collaborative Group Study contains 3154 healthy men, aged from 39 to 59, from the San Francisco area.\nAt the start of the study, all were free of heart disease.\nEight and a half years later, the study recorded whether these men now suffered from coronary heart disease (chd).\nOther recorded variables that might be related to the chance of developing this disease are:\n\nage - age in years\nheight - height in inches\nweight - weight in pounds\nsdp - systolic blood pressure in mm Hg\ndbp - diastolic blood pressure in mm Hg\nchol - fasting serum cholesterol in mm %\nbehave - behaviour type (A1, A2, B3, B4)\ncigs - number of cigarettes smoked per day\ndibep - behaviour type (A = Aggressive, P = Passive)\ntypechd - type of coronary heart disease (angina, infdeath, none, or silent)\ntimechd - time of coronary heart disease or end of follow-up\narcus - arcus senilis (absent or present)\n\n\n\n\n\nLoad the data\n\nIs this data experimental or observational? experimentalobservational\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\n\nExplore the data (initial data analysis)\n\nThere are a number of ways to explore data.\nFirst let’s start by looking at the distribution of the outcome (coronary heart disease). What do you notice?\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\nNext let’s looks at the marginal distribution of numerical covariates by the outcome. Why is the median value for timechd clustered around 3000 for those that didn’t have a coronary heart disease?\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\n\nAnswer\n\nThe study went on for 8.5 years (which is about 8.5 \\(\\times\\) 365.25 = 3105 days). The variable timechd for the group that didn’t have a coronary heart disease is related to number of days to end of follow-up. This means that those with earlier time (e.g. 1000 days) within this group means that they dropped out of study for some reason (e.g. due to death or unable to contact participant).\n\n\nLet’s look also at the marginal distribution of categorical variables by the outcome. Do the levels within a factor have a higher association with chd? What do you notice in particular about typechd?\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\n\nAnswer\n\ntypechd is derived from chd so those that did not have a coronary heart disease is all assigned “none” as expected.\n\n\nggpairs() from GGally package is useful for looking at the pairwise relationship between any two covariates in the data. It will be slow to compute if you have many variables (and individual graph may be too slow to see) so you may need to subset to a smaller number of variables first.\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\nLet’s zoom in and have a look at the relationship between sdp and dbp. What do you notice about the relationship between these variables?\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\n\nAnswer\n\nThe variables sdp and dbp are highly correlated. Systolic pressure (sdp) is the maximum blood pressure during contraction of the ventricles; while diastolic pressure (dbp) is the minimum pressure recorded just prior to the next contraction. Both measure blood pressure (in different ways) so the high correlation is perhaps expected!\n\n\nWhat is the relationship between behave and dibep?\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\n\nAnswer\n\nAll those that are assigned with value “A” for dibep are either “A1” or “A2” for behave. Similarly all that are assigned with value “B” for dipep are either “B1” or “B2” for behave. This suggests that perhaps behave was a further refinement of behaviour type based on dibep (so behave is nested within dibep).\n\n\n\nModel the data\n\nWhy would you not (or would you) use typechd and timechd as predictors in the model?\n\n\n\nAnswer\n\nThe variables typechd and timechd are calculated based on the outcome! You can’t use predictors that were derived based on the outcome.\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\nDo you think the behaviour type variable (behave) should be included in the model?\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\n\nAnswer\n\nbehave does not appear to be (statistically) significantly contribute to explaining the chd so we omit from the model.\n\n\nWhat do you think the best model that explains chd is?\n\n\nPlease enable JavaScript to experience the dynamic code cell content on this page.\n\n\nAnswer\n\nVariable selection is a hard problem! We can use stepwise selection (which goes through backward selection - drop the least signiciant variable - and forward selection - add the most significant variable, until it meets a certain criteria), but an “automated” selection like this doesn’t account for the domain context.\nFor example, sdp is in the final model selected by stepwise selection but sdp is highly correlated with dbp. Should dbp been included instead of sdp? Also weight is included but not height. Tall people would naturally weight more than short people with the same body type. Would it have been better to feature engineer another variable that normalises weight with respect to height? Body mass index (which is weight in kg divided by square of body height in metres) is supposed to account for weight with respect to height.\nRemember that all models are wrong, but some are useful. Your goal is just to find a useful model that approximates the reality well enough."
  },
  {
    "objectID": "ad.html",
    "href": "ad.html",
    "title": "ANU BDSI",
    "section": "",
    "text": "The workshop aims to teach generalised linear models for modeling data with non-normal distributions. Participants are expected to have a basic understanding of R and linear models prior to the start of the workshop.\nLearning objectives:\n\nUnderstand and apply generalized linear models (GLMs) for modeling data with non-normal distributions\nApply GLMs effectively to model binary outcomes (logistic regression) and count data (Poisson or negative binomial regression).\nFit, interpret, and assess the adequacy of GLMs\n\nThe workshop is a total of 3 hours (in-person only delivery) on the dates and times specified below.\n\nTue 24 September 2024 1-2pm\nFri 27 September 2024 12-2pm\n\nThe expression of interest (EOI) is now open for ANU staff or student here. The EOI closes on Wednesday 11th September 2024. The EOI is not a guarantee of registration. We have limited space and will contact you separately to confirm registration by Friday 13th September 2024. Preference is given to those who are ANU Master or Honours students. Please only submit your EOI if you can attend the full workshop.\nhttps://forms.office.com/Pages/ResponsePage.aspx?id=XHJ941yrJEaa5fBTPkhkN5BTqudNKKdBqhKF4XvgPSVUNE5SREQ2V09HNkxNRE5LSFYySTRDSE5LMSQlQCN0PWcu\n\n\n\nThis website is brought to you by the ANU Biological Data Science Institute."
  },
  {
    "objectID": "next-time.html",
    "href": "next-time.html",
    "title": "ANU BDSI",
    "section": "",
    "text": "This website is brought to you by the ANU Biological Data Science Institute."
  },
  {
    "objectID": "slides/slide2.html#case-study-abundance-of-noisy-miners",
    "href": "slides/slide2.html#case-study-abundance-of-noisy-miners",
    "title": "Modelling for count responses",
    "section": "Case study: Abundance of Noisy Miners",
    "text": "Case study: Abundance of Noisy Miners\n\n\n\nThe noisy miner is a small but aggressive native Australian bird.\nA study of the habitats of the noisy miner recorded the abundance of noise miners in two hectare transects located in buloke woodland patches along its characteristics,\n\nEucs = number of eucalypt trees, and\nMinerab = abundance of noisy miners.\n\n\n\n\n\nCode\ndata(nminer, package = \"GLMsData\")\nbase &lt;- nminer |&gt; \n  ggplot(aes(Eucs, Minerab)) +\n  geom_hex() +\n  colorspace::scale_fill_continuous_sequential(breaks = 1:3, palette = \"ag_GrnYl\", begin = 0.3) +\n  geom_hline(yintercept = 0, linetype = 2) +\n  theme(legend.position = \"bottom\")\n\nbase"
  },
  {
    "objectID": "slides/slide2.html#linear-regression",
    "href": "slides/slide2.html#linear-regression",
    "title": "Modelling for count responses",
    "section": "Linear regression",
    "text": "Linear regression\n\nfit_lm_asis &lt;- lm(Minerab ~ Eucs, data = nminer)\nfit_lm_sqrt &lt;- lm(sqrt(Minerab) ~ Eucs, data = nminer)\n\n\n\n\n\nCode\nbase + \n  geom_smooth(method = lm, se = FALSE, linewidth = 2) +\n  labs(title = \"lm(Minerab ~ Eucs)\") +\n  guides(fill = \"none\")\n\n\n\n\n\n\n\n\n\n\n\n\nCode\nbase +\n  geom_smooth(method = lm, se = FALSE, linewidth = 2, \n              formula = sqrt(y) ~ x, \n              aes(y = stage(Minerab, after_stat = y^2))) +\n  labs(title = \"lm(sqrt(Minerab) ~ Eucs)\") +\n  guides(fill = \"none\")\n\n\n\n\n\n\n\n\n\n\n\n\nCode\nbase +\n  geom_smooth(method = lm, se = FALSE, linewidth = 2) +\n  scale_y_sqrt() +\n  labs(title = \"lm(sqrt(Minerab) ~ Eucs)\") +\n  guides(fill = \"none\")\n\n\n\n\n\n\n\n\n\n\n\n\n\nNegative values for abundance are not possible.\nThe count of noisy miners does not have a known restrictive count for using Binomial distribution."
  },
  {
    "objectID": "slides/slide2.html#poisson-distribution",
    "href": "slides/slide2.html#poisson-distribution",
    "title": "Modelling for count responses",
    "section": "Poisson distribution",
    "text": "Poisson distribution\n\n\n\n\n\n\n\n\n\n\n\n\n\nIf Y \\sim \\text{Poisson}(\\lambda), then P(Y = y) = \\frac{e^{-\\lambda} \\lambda^y}{y!} for y = 0, 1, 2, \\ldots and \\lambda &gt; 0.\nThe mean and variance of Y are both \\lambda.\nThe Poisson distribution is often used to model (unrestricted) count data."
  },
  {
    "objectID": "slides/slide2.html#poisson-regression-model",
    "href": "slides/slide2.html#poisson-regression-model",
    "title": "Modelling for count responses",
    "section": "Poisson regression model",
    "text": "Poisson regression model\n\nWe assume Y_i \\sim \\text{Poisson}(\\mu_i) and model the mean \\mu_i as:\n\n\\log_e(\\mu_i) = \\beta_0 + \\beta_1x_{i1} + \\beta_1x_{i2} + \\ldots  + \\beta_kx_{ik}.\n\n\\hat{\\mu}_i = \\text{exp}(\\hat{\\beta}_0 + \\hat{\\beta}_1x_{i1} + \\hat{\\beta}_1x_{i2} + \\ldots  + \\hat{\\beta}_kx_{ik})"
  },
  {
    "objectID": "slides/slide2.html#modelling-unrestricted-counts-with-poisson-regression",
    "href": "slides/slide2.html#modelling-unrestricted-counts-with-poisson-regression",
    "title": "Modelling for count responses",
    "section": "Modelling (unrestricted) counts with Poisson regression",
    "text": "Modelling (unrestricted) counts with Poisson regression\n\nfit_glm &lt;- glm(Minerab ~ Eucs, data = nminer,\n               family = poisson(link = \"log\"))\n\n\n\n\n\nCode\nbase + \n  geom_smooth(method = \"glm\", se = FALSE, linewidth = 2,\n              method.args = list(family = poisson(link = \"log\"))) +\n  geom_point(aes(y = .fitted), color = \"red\", size = 5,\n             data = broom::augment(fit_glm, \n                 type.predict = \"response\",\n                 newdata = tibble(Eucs = seq(0, 30, by = 10)))) +\n  guides(fill = \"none\") +\n  labs(title = \"glm(Minerab ~ Eucs, \\n    family = poisson(link = 'log'))\") \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPredicting the response:\n\n\nbroom::augment(fit_glm, \n type.predict = \"response\",\n newdata = tibble(Eucs = seq(0, 30, by = 10)))\n\n# A tibble: 4 × 2\n   Eucs .fitted\n  &lt;dbl&gt;   &lt;dbl&gt;\n1     0   0.416\n2    10   1.30 \n3    20   4.07 \n4    30  12.7"
  },
  {
    "objectID": "slides/slide2.html#case-study-attitude-to-genetically-modified-foods",
    "href": "slides/slide2.html#case-study-attitude-to-genetically-modified-foods",
    "title": "Modelling for count responses",
    "section": "Case study: attitude to genetically modified foods",
    "text": "Case study: attitude to genetically modified foods\n\n\nCode\ngmfood &lt;- read_csv(here::here(\"data/gmfood.csv\"))\n\n\n\n\n\n\n      Attitude\nIncome Against For\n  High     151 263\n  Low      222 258\n\n\n\n\nThe data in Table 10.3 were collected between December 1996 and January 1997, and comprise a two-dimensional (or two-way) table of counts collating the attitude of Australians to genetically modified (gm) foods (factor A) according to their income (factor B)"
  },
  {
    "objectID": "slides/slide2.html#contingency-tables",
    "href": "slides/slide2.html#contingency-tables",
    "title": "Modelling for count responses",
    "section": "Contingency tables",
    "text": "Contingency tables"
  },
  {
    "objectID": "slides/slide2.html#log-linear-models",
    "href": "slides/slide2.html#log-linear-models",
    "title": "Modelling for count responses",
    "section": "Log-linear models",
    "text": "Log-linear models"
  },
  {
    "objectID": "slides/slide2.html#poisson-regression-for-contingency-tables",
    "href": "slides/slide2.html#poisson-regression-for-contingency-tables",
    "title": "Modelling for count responses",
    "section": "Poisson regression for contingency tables",
    "text": "Poisson regression for contingency tables"
  },
  {
    "objectID": "slides/slide2.html#case-study-cancer-diagnosis",
    "href": "slides/slide2.html#case-study-cancer-diagnosis",
    "title": "Modelling for count responses",
    "section": "Case study: cancer diagnosis",
    "text": "Case study: cancer diagnosis\n\ntypes of cancer diagnosed in Western Australia in 1996 were recorded for males and females\nfemales cannot have prostate cancer, and males cannot have cervical cancer\nBreast cancer is a possible, but very rare, disease among men\n\n\ndata(wacancer, package = \"GLMsData\")\nxtabs(Counts ~ Gender + Cancer, data = wacancer)\n\n      Cancer\nGender Breast Cervix Colorectal Lung Melanoma Other Prostate\n     F    875     77        355  211      282  1082        0\n     M      0      0        511  472      362  1406      923\n\ncoef(glm(Counts ~ Gender * Cancer, data = wacancer, family = poisson))\n\n             (Intercept)                  GenderM             CancerCervix \n               6.7742239              -30.0768090               -2.4304185 \n        CancerColorectal               CancerLung           CancerMelanoma \n              -0.9021061               -1.4223658               -1.1323168 \n             CancerOther           CancerProstate     GenderM:CancerCervix \n               0.2123426              -30.0768090                2.4304185 \nGenderM:CancerColorectal       GenderM:CancerLung   GenderM:CancerMelanoma \n              30.4410608               30.8819299               30.3265461 \n     GenderM:CancerOther   GenderM:CancerProstate \n              30.3387466               60.2070233 \n\ncoef(glm(Counts ~ Gender * Cancer, data = wacancer |&gt; filter(Counts &gt; 0), family = poisson))\n\n             (Intercept)                  GenderM             CancerCervix \n              6.77422389               0.26193761              -2.43041846 \n        CancerColorectal               CancerLung           CancerMelanoma \n             -0.90210610              -1.42236575              -1.13231682 \n             CancerOther           CancerProstate     GenderM:CancerCervix \n              0.21234257              -0.20853226                       NA \nGenderM:CancerColorectal       GenderM:CancerLung   GenderM:CancerMelanoma \n              0.10231419               0.54318324              -0.01220047 \n     GenderM:CancerOther   GenderM:CancerProstate \n                      NA                       NA"
  },
  {
    "objectID": "slides/slide2.html#structural-zeroes",
    "href": "slides/slide2.html#structural-zeroes",
    "title": "Modelling for count responses",
    "section": "Structural zeroes",
    "text": "Structural zeroes"
  },
  {
    "objectID": "slides/slide2.html#case-study-lung-cancer-in-danish-cities",
    "href": "slides/slide2.html#case-study-lung-cancer-in-danish-cities",
    "title": "Modelling for count responses",
    "section": "Case study: Lung cancer in Danish cities",
    "text": "Case study: Lung cancer in Danish cities\n\nNumber of incidents (out of the population) of lung cancer from 1968 to 1971 in four Danish cities recorded by age group.\n\n\n\n\n\nCode\ndata(danishlc, package = \"GLMsData\")\n\ndanishlc |&gt; \n  mutate(Age = fct_reorder(Age, parse_number(as.character(Age)), min)) |&gt; \n  ggplot(aes(Age, Cases/Pop * 1000, color = City)) + \n  geom_point(size = 3) +\n  geom_line(aes(group = City), linewidth = 1.2) +\n  geom_text(aes(label = City), \n            hjust = 0, nudge_x = 0.1,\n            data = ~filter(., Age == \"&gt;74\"), size = 9) +\n  guides(color = \"none\") +\n  labs(y = \"Cases per 1000 people\", x = \"Age group\") +\n  scale_x_discrete(expand = expansion(mult = c(0.1, 0.3)))"
  },
  {
    "objectID": "slides/slide2.html#modelling-rates-with-poisson-regression",
    "href": "slides/slide2.html#modelling-rates-with-poisson-regression",
    "title": "Modelling for count responses",
    "section": "Modelling rates with Poisson regression",
    "text": "Modelling rates with Poisson regression\n\nfit_glm1 &lt;- glm(Cases/Pop ~ Age*City, data = danishlc,\n                  family = poisson(link = \"log\"))\n\nfit_glm2 &lt;- glm(Cases ~ offset(log(Pop)) + Age*City, data = danishlc,\n                  family = poisson(link = \"log\"))\n\n\\log\\left(\\frac{\\mu_i}{\\texttt{Pop}_i}\\right) =  \\beta_0 + \\beta_{1\\texttt{Age}_i} + \\beta_{2\\texttt{City}_i} + \\beta_{3\\texttt{AgeCity}_i}\n\\log(\\mu_i) = \\log(\\texttt{Pop}_i) + \\beta_0 + \\beta_{1\\texttt{Age}_i} + \\beta_{2\\texttt{City}_i} + \\beta_{3\\texttt{AgeCity}_i}"
  },
  {
    "objectID": "slides/slide2.html#chi-square-test",
    "href": "slides/slide2.html#chi-square-test",
    "title": "Modelling for count responses",
    "section": "Chi-square test",
    "text": "Chi-square test\n\nanova(fit_glm2, test = \"Chisq\")\n\nAnalysis of Deviance Table\n\nModel: poisson, link: log\n\nResponse: Cases\n\nTerms added sequentially (first to last)\n\n         Df Deviance Resid. Df Resid. Dev Pr(&gt;Chi)    \nNULL                        23    129.908             \nAge       5  101.601        18     28.307  &lt; 2e-16 ***\nCity      3    4.859        15     23.447  0.18241    \nAge:City 15   23.447         0      0.000  0.07509 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\nWe retain only Age in the model."
  },
  {
    "objectID": "slides/slide2.html#predicting-rate-response-with-poisson-regression",
    "href": "slides/slide2.html#predicting-rate-response-with-poisson-regression",
    "title": "Modelling for count responses",
    "section": "Predicting rate response with Poisson regression",
    "text": "Predicting rate response with Poisson regression\n\nfit_glm3 &lt;- glm(Cases ~ offset(log(Pop)) + Age, data = danishlc,\n                family = poisson(link = \"log\"))\n\n\n\n\n\nCode\nbroom::augment(fit_glm3, type.predict = \"response\") |&gt; \n  mutate(Pop = exp(`offset(log(Pop))`)) |&gt; \n  mutate(Age = fct_reorder(Age, parse_number(as.character(Age)), min)) |&gt; \n  ggplot(aes(Age, Cases/Pop * 1000)) +\n  geom_point(size = 3) +\n  geom_point(aes(y = .fitted/Pop * 1000), color = \"blue\", size = 4) +\n  geom_line(aes(y = .fitted/Pop * 1000), color = \"blue\", group = 1, linewidth = 1.2) +\n  labs(y = \"Cases per 1000 people\", x = \"Age group\") \n\n\n\n\n\n\n\n\n\n\n\nbroom::augment(fit_glm3, \n   type.predict = \"response\", \n   newdata = danishlc |&gt; \n        distinct(Age) |&gt; \n        mutate(Pop = 1000)) \n\n# A tibble: 6 × 3\n  Age     Pop .fitted\n  &lt;fct&gt; &lt;dbl&gt;   &lt;dbl&gt;\n1 40-54  1000    2.84\n2 55-59  1000    8.40\n3 60-64  1000   12.8 \n4 65-69  1000   16.4 \n5 70-74  1000   18.0 \n6 &gt;74    1000   11.6"
  },
  {
    "objectID": "slides/slide2.html#case-study-pock",
    "href": "slides/slide2.html#case-study-pock",
    "title": "Modelling for count responses",
    "section": "Case study: pock",
    "text": "Case study: pock\n\ndata(pock, package = \"GLMsData\")\n\n\n\nCode\nggplot(pock, aes(Dilution, Count)) +\n  ggbeeswarm::geom_quasirandom(width = 0.2) +\n  scale_x_continuous(transform = \"log2\")"
  },
  {
    "objectID": "slides/slide2.html#overdispersion",
    "href": "slides/slide2.html#overdispersion",
    "title": "Modelling for count responses",
    "section": "Overdispersion",
    "text": "Overdispersion\n\n\n\n\nCode\npock |&gt; \n  summarise(mean = mean(Count), var = var(Count),\n            .by = Dilution) |&gt;\n  ggplot(aes(mean, var)) + \n  geom_point(size =3) +\n  geom_abline(intercept = 0, slope = 1, linetype = 2)"
  },
  {
    "objectID": "slides/slide2.html#gamma-distrbution",
    "href": "slides/slide2.html#gamma-distrbution",
    "title": "Modelling for count responses",
    "section": "Gamma distrbution",
    "text": "Gamma distrbution\n\n\n\n\n\n\n\n\n\n\n\n\nSuppose Y \\sim \\text{Gamma}(k, \\theta)\nf(y) = \\frac{1}{\\Gamma(k)\\theta^k}y^{k-1}e^{-y/\\theta}\nE(Y) = k\\theta and var(Y) = k\\theta^2"
  },
  {
    "objectID": "slides/slide2.html#negative-binomial-distribution",
    "href": "slides/slide2.html#negative-binomial-distribution",
    "title": "Modelling for count responses",
    "section": "Negative binomial distribution",
    "text": "Negative binomial distribution\n\n\n\n\n\n\n\n\n\n\n\n\nY \\sim \\text{Negative Binomial}(m, k)\n\nP(Y = y) = \\frac{\\Gamma(y + k)}{\\Gamma(y + 1) \\Gamma(k)} \\left(\\frac{m}{m + k}\\right)^{y} \\left(\\frac{k}{m + k}\\right)^{k}\n\nwhere m is the mean and k is the inverse of the dispersion parameter.\nE(Y) = m and \\text{Var}(Y) = m + \\frac{1}{r}m^2"
  },
  {
    "objectID": "slides/slide2.html#negative-binomial-regression",
    "href": "slides/slide2.html#negative-binomial-regression",
    "title": "Modelling for count responses",
    "section": "Negative binomial regression",
    "text": "Negative binomial regression\nY_i \\sim \\text{Poisson}(\\lambda_i) and \\lambda_i \\sim \\text{Gamma}(\\mu_i, \\psi)\nE(Y_i) = \\mu_i and \\text{Var}(Y_i) = \\mu_i + \\psi \\mu_i^2\nP(Y_i = y_i) = \\frac{\\Gamma(y_i + k)}{\\Gamma(y_i + 1) \\Gamma(k)} \\left(\\frac{\\mu_i}{\\mu_i + k}\\right)^{y_i} \\left(\\frac{k}{\\mu_i + k}\\right)^{k}\nAbove is the same as Y_i \\sim \\text{Negative Binomial}(\\mu_i, k) where k = \\frac{1}{\\psi}\nIf \\psi = 0 then Negative Binomial reduces to Poisson."
  },
  {
    "objectID": "slides/slide2.html#modelling-with-negative-binomial-regression",
    "href": "slides/slide2.html#modelling-with-negative-binomial-regression",
    "title": "Modelling for count responses",
    "section": "Modelling with negative binomial regression",
    "text": "Modelling with negative binomial regression\n\nfit_nb &lt;- MASS::glm.nb(Count ~ log2(Dilution), data = pock)\nfit_nb$theta # estimate of k\n\n[1] 9.892894\n\ncoef(fit_nb)\n\n   (Intercept) log2(Dilution) \n     5.3328439     -0.7245983"
  },
  {
    "objectID": "slides/slide2.html#summary",
    "href": "slides/slide2.html#summary",
    "title": "Modelling for count responses",
    "section": "Summary",
    "text": "Summary\n\nYou can model (unrestricted) count or rate data with Poisson regression using glm(y ~ x, family = poisson())\nFor rate data with the total size, glm(y ~ offset(log(size)) + x, family = poisson())\nIf the data is overdispersed (variance &gt; mean), you can use Negative Binomial regression. MASS::glm.nb(y ~ x).\n\n\n\n\n\nanu-bdsi.github.io/workshop-GLM/"
  }
]